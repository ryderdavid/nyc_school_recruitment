---
title: "HUM II Recruitment"
author: "Ryder Cobean"
output: html_document
---


This report attempts to answer a number of questions for Humanities II Charter School in The Bronx, New York City.

# 



## Special Groups Recruitment
#### Question: If I want to to target and recruit ells, where would the most sensible places be to work on targeted recruitment?

One question posed was what strategies could be employed to better target ELL recruitment efforts. 
This report reviewed the data from NYC's Department of Education on enrollment statistics in `r length(unique(districts_demo_snapshot_1718$school_dist))` districts, focusing on those in Manhattan and The Bronx. 

```{r message=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
# Percentile formatting
schools_percentile <- 0.95

if((schools_percentile * 100) %% 10 == 1) {
  sch_pctile_ord <- paste(as.character(schools_percentile * 100), "st", sep="")
} else if ((schools_percentile * 100) %% 10 == 2) {
  sch_pctile_ord <- paste(as.character(schools_percentile * 100), "nd", sep="")
} else if ((schools_percentile * 100) %% 10 == 3) {
  sch_pctile_ord <- paste(as.character(schools_percentile * 100), "rd", sep="")
} else {
  sch_pctile_ord <- paste(as.character(schools_percentile * 100), "th", sep="")
}
```

Below is the distribution of English Language Learner recruitment among districts and schools in New York, focusing on Manhattan and the Bronx. The second plot highlights those schools recruiting ELL students at the `r paste(sch_pctile_ord)` percentile relative to all schools in New York.
```{r message=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
# source("datasets.R", print.eval = F)
tmap_mode("plot")
plot1 <- tm_shape(nyc_area_zips, bbox = c(manhattan_sf, bronx_sf)) +
  tm_fill(col = "grey90") + 
  tm_shape(districts_demo_snapshot_1718, point.per = "feature") + 
  tm_borders() + 
  tm_fill(col = "pct_ell", title = "% ELL Enrollment, 2017-18", palette = "BuGn") +
  tm_text("school_dist") +
  tm_layout(legend.position = c("left", "top"),
            title = "Percentage of ELL enrollment by district, 2017-18",
            title.bg.color = "white", title.bg.alpha = 0.6)

# Plot schools in determined percentile for ELL enrollment in Manhattan and The Bronx:
high_ell_schools_man_bx <- schools_demo_snapshot_1718 %>% 
  filter(pct_ell > quantile(.$pct_ell, schools_percentile)) %>% 
  filter(boro %in% c("X", "M")) %>%
  .[, c("dbn", "school_name", "total_enrollment", "pct_ell")]

plot2 <- tm_shape(nyc_area_zips, bbox = c(manhattan_sf, bronx_sf)) + 
  tm_fill(col = "grey90") +
  tm_shape(nyc_sds) + tm_borders() + tm_fill(alpha = 0) +
  tm_shape(high_ell_schools_man_bx) + 
  tm_symbols(col = "red",
             size = "pct_ell",
             title.size = "% ELL enrollment",
             perceptual = T,
             sizes.legend = c(40,60,80,100), legend.size.is.portrait = F) + 
  tm_layout(legend.position = c("right", "bottom"),
            legend.bg.color = "white", legend.bg.alpha = 1, legend.frame = "black",
            title = paste(sch_pctile_ord, 
                     "percentile ELL-enrolling schools, Manhattan/Bronx"),
            title.position = c("center", "top"),
            title.bg.color = "white", title.bg.alpha = 0.6)

tmap_arrange(plot1, plot2, ncol = 2, asp = 1)
```

#### Limited English Proficiency Households
One angle for targetting recruitment efforts is examining the distribution of "limited English proficiency" households in New York. The [American Community Survey](https://www.census.gov/programs-surveys/acs/news/data-releases.html?# "American Community Survey 2017 Data Releases") tabulates limited English proficiency households by census tract, which are defined as households that do not solely speak English, in which at least one member is reported by the respondent to speak English "not very well."

The below interactive map shows the percentage of limited English proficiency households per census tract in NYC, with school district boundaries overlaid.

```{r message=FALSE, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

# GET 2017 5YR ACS HOUSEHOLD LANGUAGE SPOKEN BY LIMITED ENGLISH SPEAKING STATUS
options(tigris_use_cache = TRUE)
lep_hh_by_tract_C16002 <- 
  get_acs(geography = "tract", year = 2017, state = "NY", 
          county = c("New York", "Bronx", "Richmond", "Queens", "Kings"),
          output = "wide",
          geometry = T,
          variables = c(total_hh = "C16002_001E", 
                        spanish_lep = "C16002_004E",
                        indeur_lep = "C16002_007E",
                        asnpacisl_lep = "C16002_010E",
                        otherlang_lep = "C16002_013E")) %>% 
  st_transform(crs = wgs84_crs) %>% 
  st_erase(., nyc_water)

# break out the data from the sf object and summarize across rows for each
# language's limited english proficiency respondents. Make sure to not introduce
# NaN's by dividing by zero!
lep_hh_by_tract_C16002 %>% as_tibble() %>% 
  filter(total_hh != 0) %>% # remove zero occupancy tracts like airports and parks
  transmute(total_lep = select(., spanish_lep, indeur_lep, 
                               asnpacisl_lep, otherlang_lep) %>% rowSums(),
            pct_lep = ifelse(total_lep == 0, 0, 100 * total_lep / total_hh), 
            GEOID = GEOID) -> total_lep_by_tract


# merge the data back into the geometry
lep_hh_by_tract_C16002 <- inner_join(lep_hh_by_tract_C16002, 
                                    total_lep_by_tract, 
                                    by = c("GEOID" = "GEOID"))

# prep for plotting: add school districts for each tract, remove NA records,
lep_hh_by_tract_C16002 <- st_join(lep_hh_by_tract_C16002, nyc_sds) # %>% 
  # filter(!is.na(pct_lep))


tmap_mode("view")
tm_basemap(leaflet::providers$CartoDB.PositronNoLabels) + 
tm_shape(nyc_sds, point.per = "feature", bbox = man_bx_bbox) + 
  tm_borders(alpha = 0.8) + 
  tm_text("school_dist") +
tm_shape(lep_hh_by_tract_C16002) + 
  tm_borders(alpha = 0.2) + 
  tm_fill(col = "pct_lep", 
          palette = "Reds",
          title = "% LEP Households",
          id = "NAME",
          showNA = F,
          popup.vars = c("Tract ID"="GEOID", "Name"="NAME", 
                         "School District"="school_dist",
                         "Total Households"="total_hh",
                         "% LEP Households"="pct_lep"))

# # Hidden: Plot mode available for printed version of report.
# tmap_mode("plot")
# tm_shape(nyc_area_zips, bbox = c(manhattan_sf, bronx_sf)) + tm_fill(col = "grey90") +
# tm_shape(lep_tracts) +
#   tm_fill("pct_lep", palette = "Reds", style = "pretty",
#           title = "% LEP households\nby census Tract") +
#   tm_borders(alpha = 0.1) +
#   tm_credits("Source: 2013-2017 ACS Five-Year Estimates",
#              bg.color = "white", bg.alpha = 0.7, position = c("left", "bottom")) +
#   tm_layout(legend.position = c("left", "top"),
#             legend.height = .4,
#             legend.width = .8,
#             legend.title.size = 1,
#             legend.title.fontface = "bold
```



The following tracts house exceptionally high (above 90th percentile) proportions of limited English proficiency households:
``` {r message=FALSE, cache=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
lep_hh_pctile <- quantile(lep_hh_by_tract_C16002$pct_lep, 0.8, na.rm = T)


tmap_mode("view")
tm_basemap(leaflet::providers$CartoDB.PositronNoLabels) + 
tm_shape(nyc_sds, point.per = "feature", bbox = man_bx_bbox) + 
  tm_borders(alpha = 0.8) + 
  tm_text("school_dist") +
tm_shape(lep_hh_by_tract_C16002 %>% 
           filter(!is.na(pct_lep)) %>% 
           filter(pct_lep >= lep_hh_pctile)
         ) + 
  tm_borders(alpha = 0.2) + 
  tm_fill(col = "pct_lep", 
          palette = "Reds",
          title = "% LEP Households",
          id = "NAME",
          showNA = F,
          popup.vars = c("Tract ID"="GEOID", "Name"="NAME", 
                         "School District"="school_dist",
                         "Total Households"="total_hh",
                         "% LEP Households"="pct_lep"))

```

For targeting these areas, two options stand out: mailers to dense housing, and bus shelter/bus line advertisements in these areas.



<!-- ```{r echo=FALSE, message=FALSE} -->
<!-- # tmap_mode("view") -->
<!-- # tm_shape(nyc_sds) + tm_borders() + tm_fill(alpha = 0) + -->
<!-- #   tm_shape(high_ell_schools_man_bx, bbox = high_ell_schools_man_bx) +  -->
<!-- #   tm_dots(col = "red",  -->
<!-- #              size = "pct_ell") +  -->
<!-- #   tm_view(bbox = c(manhattan_sf, bronx_sf), -->
<!-- #           set.zoom.limits = c(11,15), -->
<!-- #           dot.size.fixed = F) -->
<!-- ``` -->

