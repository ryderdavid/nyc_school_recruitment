tmap_nyc_background() +
tm_shape(sd_demo_snap_18_spatial) + tm_borders() +
tm_fill(col = "english_language_learners_2", title = "% ELL",
palette = "Blues") +
tm_text(text = "name_label") +
tm_layout(main.title = paste("Percentage of ELL by district\n",
"total enrollment, 2018"),
main.title.position = "center",
legend.position = c("left","top")) +
tm_credits(paste("NYC Department of Education,",
"\n2013 - 2018 Demographic Snapshot - District"),
position = c("center", "BOTTOM"),
align = "center")
check.packages <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# To build on linux, need local package gdal, units (udunits on arch), v8-3.14 (source on AUR), gcc-fortran, unixodbc
packages <- c('sf', 'devtools', 'acs', 'tidycensus', 'tigris', 'sp',
'tmap', 'tmaptools', 'readxl', 'ggplot2', 'rgdal', 'spdplyr', 'RColorBrewer',
'viridis', 'viridisLite', 'rstudioapi', 'tidyverse', 'getPass')
check.packages(packages)
set_sourcefile_wd <- function() {
library(rstudioapi) #
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
print( getwd() )
}
set_sourcefile_wd()
source("functions.R")
sch_dem_snap <- schools_demo_snapshot %>% filter(year == "2017-18") %>%
dplyr::select(dbn, school_name, year, total_enrollment, num_ell,
pct_ell, num_pov, pct_pov, num_swd, pct_swd)
sch_dem_snap <- inner_join(school_points, sch_dem_snap, by=c("ats_code" = "dbn"))
avg_swd <- mean(sch_dem_snap$pct_swd)
avg_ell <- mean(sch_dem_snap$pct_ell)
# filter schools spdf for schools in 90th or greater percentile of % ELL
# enrollment
schools_with_high_ell <- sch_dem_snap %>% filter(pct_ell > quantile(pct_ell, .9))
schools_with_high_ell
tmap_man_bx_background() + tm_shape(schools_with_high_ell) + tm_dots(size = "pct_ell")
st_join(schools_with_high_ell, nyc_tracts, join = st_intersects) -> test_1
tmap_man_bx_background() + tm_shape(schools_with_high_ell) + tm_dots(size = 2)
tmap_man_bx_background() + tm_shape(schools_with_high_ell) + tm_dots(size = .5)
tmap_man_bx_background() + tm_shape(schools_with_high_ell) + tm_dots(size = .1)
tmap_man_bx_background() + tm_shape(schools_with_high_ell) + tm_dots()
st_intersection(nyc_tracts, schools_with_high_ell) -> high_ell_tracts
high_ell_tracts
plot(test_1)
st_intersect(nyc_tracts, schools_with_high_ell) -> high_ell_tracts
st_intersects(nyc_tracts, schools_with_high_ell) -> high_ell_tracts
high_ell_tracts
high_ell_tracts[[1]]
high_ell_tracts[[4]]
install.packages(c("BH", "colorspace", "e1071", "rlang", "tibble"))
